<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waveguide Generator</title>
    <link rel="stylesheet" href="src/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Space+Mono&display=swap"
        rel="stylesheet">
    <script type="importmap">
        {
            "imports": {
                "three": "./node_modules/three/build/three.module.js",
                "three/addons/": "./node_modules/three/examples/jsm/"
            }
        }
    </script>
</head>

<body>
    <div id="ui-panel">
        <h1>Waveguide Generator</h1>

        <!-- Tab Navigation -->
        <div class="tab-navigation" role="tablist" aria-label="Main panels">
            <button class="tab-btn active" id="geometry-tab-btn" data-tab="geometry" role="tab"
                aria-controls="geometry-tab" aria-selected="true" tabindex="0">Geometry</button>
            <button class="tab-btn" id="simulation-tab-btn" data-tab="simulation" role="tab"
                aria-controls="simulation-tab" aria-selected="false" tabindex="-1">Simulation</button>
        </div>

        <!-- Geometry Tab Content -->
        <div id="geometry-tab" class="tab-content active" role="tabpanel" aria-labelledby="geometry-tab-btn">
            <div id="param-container"></div>
        </div>

        <!-- Simulation Tab Content -->
        <div id="simulation-tab" class="tab-content" role="tabpanel" aria-labelledby="simulation-tab-btn" hidden>
            <div class="section">
                <h3>SIMULATION SETTINGS</h3>
                <div class="input-row">
                    <label for="freq-start">Start Freq (Hz)</label>
                    <input type="number" id="freq-start" value="100" min="20" max="20000" step="10">
                </div>
                <div class="input-row">
                    <label for="freq-end">End Freq (Hz)</label>
                    <input type="number" id="freq-end" value="10000" min="20" max="20000" step="10">
                </div>
                <div class="input-row">
                    <label for="freq-steps">Num Frequencies</label>
                    <input type="number" id="freq-steps" value="50" min="10" max="200" step="1">
                </div>
                <hr>
                <h4 class="section-subtitle">DIRECTIVITY MAP</h4>
                <div class="input-row">
                    <label for="polar-angle-start">Angle Start (deg)</label>
                    <input type="number" id="polar-angle-start" value="0" min="0" max="360" step="1">
                </div>
                <div class="input-row">
                    <label for="polar-angle-end">Angle End (deg)</label>
                    <input type="number" id="polar-angle-end" value="180" min="0" max="360" step="1">
                </div>
                <div class="input-row">
                    <label for="polar-angle-step">Angle Step (deg)</label>
                    <input type="number" id="polar-angle-step" value="5" min="1" max="90" step="1">
                </div>
                <div class="input-row">
                    <label for="polar-norm-angle">Norm Angle (deg)</label>
                    <input type="number" id="polar-norm-angle" value="5" min="0" max="90" step="1">
                </div>
                <div class="input-row">
                    <label for="polar-distance">Distance (m)</label>
                    <input type="number" id="polar-distance" value="2" min="0.1" max="10" step="0.1">
                </div>
                <div class="input-row">
                    <label>Polar Axes</label>
                    <div class="polar-axis-options">
                        <label class="polar-axis-option">
                            <input type="checkbox" id="polar-axis-horizontal" checked>
                            Horizontal (0°)
                        </label>
                        <label class="polar-axis-option">
                            <input type="checkbox" id="polar-axis-vertical" checked>
                            Vertical (90°)
                        </label>
                        <label class="polar-axis-option">
                            <input type="checkbox" id="polar-axis-diagonal" checked>
                            Diagonal
                        </label>
                    </div>
                </div>
                <div class="input-row">
                    <label for="polar-inclination">Diagonal Angle (deg)</label>
                    <input type="number" id="polar-inclination" value="45" min="0" max="360" step="1">
                </div>
            </div>

            <div id="simulation-param-container"></div>

            <div id="results-container" class="is-hidden">
                <div class="section">
                    <h3>SIMULATION RESULTS</h3>
                    <div class="input-row">
                        <label for="smoothing-select">Smoothing</label>
                        <select id="smoothing-select">
                            <option value="none">None (Ctrl+0)</option>
                            <option value="1/1">1/1 Octave (Ctrl+Shift+1)</option>
                            <option value="1/2">1/2 Octave (Ctrl+Shift+2)</option>
                            <option value="1/3">1/3 Octave (Ctrl+Shift+3)</option>
                            <option value="1/6">1/6 Octave (Ctrl+Shift+6)</option>
                            <option value="1/12">1/12 Octave (Ctrl+Shift+7)</option>
                            <option value="1/24">1/24 Octave (Ctrl+Shift+8)</option>
                            <option value="1/48">1/48 Octave (Ctrl+Shift+9)</option>
                            <option value="variable">Variable (Ctrl+Shift+X)</option>
                            <option value="psychoacoustic">Psychoacoustic (Ctrl+Shift+Y)</option>
                            <option value="erb">ERB (Ctrl+Shift+Z)</option>
                        </select>
                    </div>
                    <div id="results-charts"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="ui-panel-resizer" aria-hidden="true"></div>
    <div id="actions-panel">
        <details id="actions-panel-details" open>
            <summary>Actions <span id="stats">Vertices: 0 | Triangles: 0</span></summary>
            <div class="section actions-section">
                <button id="render-btn" class="is-hidden">Update Model</button>

                <h4 class="actions-group-title">Project</h4>
                <div class="button-row">
                    <button id="load-config-btn" class="secondary">Load Config</button>
                    <button id="export-config-btn" class="secondary">Export Config</button>
                </div>
                <input type="file" id="config-upload" class="is-hidden" accept=".txt,.cfg">
                <div class="button-row">
                    <button id="check-updates-btn" class="secondary">Check for App Updates</button>
                </div>

                <hr>
                <h4 class="actions-group-title">Output & Viewer</h4>
                <div class="button-row">
                    <div class="input-row">
                        <label for="export-prefix">Output Name</label>
                        <input type="text" id="export-prefix" value="horn_design">
                    </div>
                    <div class="input-row">
                        <label for="export-counter">Counter</label>
                        <input type="number" id="export-counter" value="1" min="1" step="1">
                    </div>
                </div>
                <div class="input-row" id="output-folder-row">
                    <button id="choose-folder-btn" class="secondary button-compact">Choose Folder</button>
                    <span id="output-folder-name" class="output-folder-name">No folder selected</span>
                </div>
                <div class="input-row-inline">
                    <label for="live-update">Real-time Updates</label>
                    <input type="checkbox" id="live-update" checked>
                </div>
                <div class="input-row-inline">
                    <label for="display-mode">Display Mode</label>
                    <select id="display-mode">
                        <option value="standard">Standard (Metal)</option>
                        <option value="zebra">Zebra Stripes</option>
                        <option value="grid">Grid / Wireframe</option>
                        <option value="curvature">Curvature Map</option>
                    </select>
                </div>

                <hr>
                <h4 class="actions-group-title">Simulation</h4>
                <div class="status-indicator" role="status" aria-live="polite" aria-atomic="true">
                    <span id="solver-status" class="status-dot"></span>
                    <span id="solver-status-text">Checking connection...</span>
                </div>
                <p id="solver-status-help" class="status-help">
                    BEM solver requires Python backend running on localhost:8000
                </p>
                <div id="simulation-progress" class="is-hidden">
                    <div id="simulation-progressbar" class="progress-bar" role="progressbar"
                        aria-label="Simulation progress" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"
                        aria-valuetext="Not started">
                        <div id="progress-fill" class="progress-fill"></div>
                    </div>
                    <p id="progress-text" class="progress-text" role="status" aria-live="polite"></p>
                </div>
                <div class="input-row-inline">
                    <label for="download-sim-mesh">Download simulation mesh on start</label>
                    <input type="checkbox" id="download-sim-mesh">
                </div>
                <div class="button-row">
                    <button id="run-simulation-btn">Start BEM Simulation</button>
                    <button id="stop-simulation-btn" class="secondary" disabled>Stop</button>
                </div>
                <div id="simulation-jobs" class="simulation-jobs">
                    <div class="simulation-jobs-header">
                        <span>Simulation Jobs</span>
                        <div class="simulation-jobs-header-actions">
                            <button id="clear-failed-jobs-btn" class="secondary button-compact" type="button">Clear Failed</button>
                            <button id="refresh-jobs-btn" class="secondary button-compact" type="button">Refresh</button>
                        </div>
                    </div>
                    <div id="simulation-jobs-list" class="simulation-jobs-list"></div>
                </div>
            </div>
        </details>
    </div>

    <div id="canvas-container">
        <div class="viewer-controls">
            <button id="zoom-in" title="Zoom In">+</button>
            <button id="zoom-out" title="Zoom Out">−</button>
            <button id="camera-toggle" title="Toggle Perspective/Orthographic">⬚</button>
            <button id="focus-horn" title="Focus on Horn">⊙</button>
            <button id="zoom-reset" title="Reset View">⟲</button>
        </div>
    </div>

    <script src="./node_modules/jszip/dist/jszip.min.js"></script>
    <script type="module" src="src/main.js"></script>
</body>

</html>
