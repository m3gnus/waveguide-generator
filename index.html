<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MWG - Mathematical Waveguide Generator</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Space+Mono&display=swap"
        rel="stylesheet">
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>

<body>
    <div id="ui-panel">
        <h1>MWG - Mathematical Waveguide Generator</h1>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" data-tab="geometry">Geometry</button>
            <button class="tab-btn" data-tab="simulation">Simulation</button>
        </div>

        <!-- Geometry Tab Content -->
        <div id="geometry-tab" class="tab-content active">
            <div class="section">
                <h3>ACTIONS</h3>
                <button id="render-btn">Update Model</button>
                <div class="button-row">
                    <button id="load-config-btn" class="secondary">Load Config</button>
                    <button id="export-config-btn" class="secondary">Export Config</button>
                </div>
                <input type="file" id="config-upload" accept=".txt,.cfg" style="display: none;">
                <button id="export-csv-btn" class="secondary">Export CSV Profiles</button>
                <button id="export-btn" class="secondary">Export STL</button>
                <button id="export-msh-btn" class="secondary">Export MSH</button>
                <button id="export-abec-btn" class="secondary">Export ABEC Project</button>

                <hr>
                <div class="input-row">
                    <label for="export-prefix">Prefix</label>
                    <input type="text" id="export-prefix" value="horn_design" style="width: 100%;">
                </div>
                <div class="input-row">
                    <label for="export-counter">Counter</label>
                    <input type="number" id="export-counter" value="1" min="1" step="1">
                </div>

                <div class="checkbox-group" style="margin-top: 15px;">
                    <input type="checkbox" id="live-update" checked>
                    <label for="live-update">Real-time Updates</label>
                </div>

                <label for="display-mode">Display Mode</label>
                <select id="display-mode">
                    <option value="standard">Standard (Metal)</option>
                    <option value="zebra">Zebra Stripes</option>
                    <option value="grid">Grid / Wireframe</option>
                    <option value="curvature">Curvature Map</option>
                </select>
            </div>

            <div id="param-container"></div>
        </div>

        <!-- Simulation Tab Content -->
        <div id="simulation-tab" class="tab-content">
            <div class="section">
                <h3>BEM SOLVER STATUS</h3>
                <div class="status-indicator">
                    <span id="solver-status" class="status-dot"></span>
                    <span id="solver-status-text">Checking connection...</span>
                </div>
                <p class="status-help">
                    BEM solver requires Python backend running on localhost:8000
                </p>
            </div>

            <div class="section">
                <h3>SIMULATION SETTINGS</h3>
                <div class="input-row">
                    <label for="freq-start">Start Freq (Hz)</label>
                    <input type="number" id="freq-start" value="100" min="20" max="20000" step="10">
                </div>
                <div class="input-row">
                    <label for="freq-end">End Freq (Hz)</label>
                    <input type="number" id="freq-end" value="10000" min="20" max="20000" step="10">
                </div>
                <div class="input-row">
                    <label for="freq-steps">Num Frequencies</label>
                    <input type="number" id="freq-steps" value="50" min="10" max="200" step="1">
                </div>
                <div class="input-row">
                    <label for="sim-type">Simulation Type</label>
                    <select id="sim-type">
                        <option value="1">Infinite Baffle</option>
                        <option value="2">Free-Standing</option>
                    </select>
                </div>
            </div>

            <div id="simulation-param-container"></div>

            <div class="section">
                <h3>DIRECTIVITY MAP (ABEC.Polars)</h3>
                <div class="input-row">
                    <label for="polar-angle-range">Map Angle Range (deg)</label>
                    <input type="text" id="polar-angle-range" value="0,180,37" placeholder="start,end,steps">
                </div>
                <div class="input-row">
                    <label for="polar-norm-angle">Norm Angle (deg)</label>
                    <input type="number" id="polar-norm-angle" value="5" min="0" max="90" step="1">
                </div>
                <div class="input-row">
                    <label for="polar-distance">Distance (m)</label>
                    <input type="number" id="polar-distance" value="2" min="0.1" max="10" step="0.1">
                </div>
                <div class="input-row">
                    <label for="polar-inclination">Inclination (deg)</label>
                    <input type="number" id="polar-inclination" value="35" min="0" max="90" step="1">
                </div>
            </div>

            <div class="section">
                <h3>ACTIONS</h3>
                <button id="run-simulation-btn">Run BEM Simulation</button>
                <button id="export-results-btn" class="secondary" disabled>Export Results</button>
                <div id="simulation-progress" style="display: none;">
                    <div class="progress-bar">
                        <div id="progress-fill" class="progress-fill"></div>
                    </div>
                    <p id="progress-text" class="progress-text">Initializing...</p>
                </div>
            </div>

            <div id="results-container" style="display: none;">
                <div class="section">
                    <h3>SIMULATION RESULTS</h3>
                    <div class="input-row">
                        <label for="smoothing-select">Smoothing</label>
                        <select id="smoothing-select">
                            <option value="none">None (Ctrl+0)</option>
                            <option value="1/1">1/1 Octave (Ctrl+Shift+1)</option>
                            <option value="1/2">1/2 Octave (Ctrl+Shift+2)</option>
                            <option value="1/3">1/3 Octave (Ctrl+Shift+3)</option>
                            <option value="1/6">1/6 Octave (Ctrl+Shift+6)</option>
                            <option value="1/12">1/12 Octave (Ctrl+Shift+7)</option>
                            <option value="1/24">1/24 Octave (Ctrl+Shift+8)</option>
                            <option value="1/48">1/48 Octave (Ctrl+Shift+9)</option>
                            <option value="variable">Variable (Ctrl+Shift+X)</option>
                            <option value="psychoacoustic">Psychoacoustic (Ctrl+Shift+Y)</option>
                            <option value="erb">ERB (Ctrl+Shift+Z)</option>
                        </select>
                    </div>
                    <div id="results-charts"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="ui-panel-resizer" aria-hidden="true"></div>

    <div id="stats">Vertices: 0 | Triangles: 0</div>
    <div id="canvas-container">
        <div class="viewer-controls">
            <button id="zoom-in" title="Zoom In">+</button>
            <button id="zoom-out" title="Zoom Out">−</button>
            <button id="camera-toggle" title="Toggle Perspective/Orthographic">⬚</button>
            <button id="focus-horn" title="Focus on Horn">⊙</button>
            <button id="zoom-reset" title="Reset View">⟲</button>
        </div>
    </div>

    <script type="module" src="src/main.js"></script>
</body>

</html>
